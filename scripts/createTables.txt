CREATE TABLE CLIENTES (
    CPF VARCHAR2(14) NOT NULL,
    NOME VARCHAR2(20) NOT NULL,
    CONTATO VARCHAR2(13) NOT NULL,
    
    CONSTRAINT PK_CLI PRIMARY KEY (CPF),
    CONSTRAINT CK_CLI_CON CHECK(REGEXP_LIKE(CONTATO, '[0-9]{2}\-[0-9]{5}\-[0-9]{4}')),
    CONSTRAINT CK_CLI_CPF CHECK(REGEXP_LIKE(CPF, '[0-9]{3}\.[0-9]{3}\.[0-9]{3}\-[0-9]{2}'))
);

CREATE TABLE FESTAS(
    ID NUMBER NOT NULL,
    DATA_HORA DATE NOT NULL,
    LOCAL VARCHAR2(20) NOT NULL,
    CLIENTE VARCHAR2(14) NOT NULL,
    TIPO VARCHAR2(9) NOT NULL,
    
    CONSTRAINT PK_FES PRIMARY KEY (ID),
    CONSTRAINT UN_FES UNIQUE (DATA_HORA, LOCAL),
    CONSTRAINT FK_FES_CLI FOREIGN KEY (CLIENTE) REFERENCES CLIENTES(CPF) ON DELETE CASCADE,
    CONSTRAINT CK_FES_TIP CHECK(UPPER(TIPO) IN('CASAMENTO', 'INFANTIL'))
);

CREATE TABLE CASAMENTOS (
    FESTA_ID NUMBER NOT NULL,
    CASAMENTO_LOCAL_CERIMONIAL VARCHAR2(20),
    
    CONSTRAINT PK_CAS PRIMARY KEY (FESTA_ID),
    CONSTRAINT FK_FES_CAS FOREIGN KEY (FESTA_ID) REFERENCES FESTAS(ID) ON DELETE CASCADE
);



CREATE TABLE CRONOGRAMA (
    FESTA_ID NUMBER NOT NULL,
    ATIVIDADE VARCHAR2(20) NOT NULL,
    HORARIO DATE,
    
    CONSTRAINT PK_CRO PRIMARY KEY (FESTA_ID),
    CONSTRAINT FK_CRO_DH FOREIGN KEY (FESTA_ID) REFERENCES FESTAS(ID) ON DELETE CASCADE
);

 
CREATE TABLE JOGOS (
    NOME VARCHAR2(20) NOT NULL,
    NRO_JOGADORES NUMBER(2) NOT NULL,
    TIPO VARCHAR2(20) NOT NULL,
    GASTO_ENERGIA NUMBER(5),
    
    CONSTRAINT PK_JOG PRIMARY KEY (NOME),
    CONSTRAINT CK_JOG_TIP CHECK(UPPER(TIPO) IN('ELETRONICO', 'TABULEIRO', 'CARTAS'))
);

CREATE TABLE ESTILOS (
    NOME VARCHAR2(20) NOT NULL,
    
    CONSTRAINT PK_EST PRIMARY KEY (NOME)
);

CREATE TABLE JOGOS_ESTILOS (
    JOGO VARCHAR2(20) NOT NULL,
    ESTILO VARCHAR2(20) NOT NULL,
    
    CONSTRAINT PK_JE PRIMARY KEY (JOGO, ESTILO),
    CONSTRAINT FK_JE_JOG FOREIGN KEY (JOGO) REFERENCES JOGOS(NOME) ON DELETE CASCADE,
    CONSTRAINT FK_JE_EST FOREIGN KEY (ESTILO) REFERENCES ESTILOS(NOME) ON DELETE CASCADE
);

CREATE TABLE FESTA_JOGOS (
    FESTA_ID NUMBER NOT NULL,   
    JOGO VARCHAR2(20) NOT NULL,
    
    CONSTRAINT PK_FJ PRIMARY KEY (FESTA_ID, JOGO),
    CONSTRAINT FK_FJ_JOG FOREIGN KEY (JOGO) REFERENCES JOGOS(NOME) ON DELETE CASCADE,
    CONSTRAINT FK_FJ_DAT FOREIGN KEY (FESTA_ID) REFERENCES FESTAS(ID) ON DELETE CASCADE
);

CREATE TABLE FOGOS_ARTIFICIOS (
    MODELO VARCHAR2(20) NOT NULL,
    FABRICANTE VARCHAR2(20) NOT NULL,
    PRECO FLOAT,
    QUANTIDADE NUMBER(4),
    
    CONSTRAINT PK_FA PRIMARY KEY (MODELO, FABRICANTE)
);

CREATE TABLE SHOW_FOGOS (
    TIPO_SHOW VARCHAR2(20) NOT NULL,
    DURACAO NUMBER,
    CUSTO FLOAT,
    PER_SEGURANCA NUMBER(6),
    
    CONSTRAINT PK_SF PRIMARY KEY (TIPO_SHOW)
);

CREATE TABLE ARTIFICIOS_SHOW (
    SHOW VARCHAR2(20) NOT NULL,
    MOD_FOGOS VARCHAR2(20) NOT NULL,
    FAB_FOGOS VARCHAR2(20) NOT NULL,
    
    CONSTRAINT PK_AS PRIMARY KEY (SHOW, MOD_FOGOS, FAB_FOGOS),
    CONSTRAINT FK_AS_SHO FOREIGN KEY (SHOW) REFERENCES SHOW_FOGOS(TIPO_SHOW) ON DELETE CASCADE,
    CONSTRAINT FK_AS_FOG FOREIGN KEY (MOD_FOGOS, FAB_FOGOS) REFERENCES FOGOS_ARTIFICIOS (MODELO, FABRICANTE) ON DELETE CASCADE
);

CREATE TABLE TECNICOS (
    CPF VARCHAR2(14) NOT NULL,
    NOME VARCHAR2(20) NOT NULL,
    CONTATO VARCHAR2(13),
    VALOR FLOAT,
    
    CONSTRAINT PK_TEC PRIMARY KEY (CPF),
    CONSTRAINT CK_TEC_CON CHECK(REGEXP_LIKE(CONTATO, '[0-9]{2}\-[0-9]{5}\-[0-9]{4}')),
    CONSTRAINT CK_TEC_CPF CHECK(REGEXP_LIKE(CPF, '[0-9]{3}\.[0-9]{3}\.[0-9]{3}\-[0-9]{2}'))
);

CREATE TABLE REALIZACAO (
    TECNICO VARCHAR2(14) NOT NULL,
    FESTA_ID NUMBER NOT NULL,
    SHOW VARCHAR2(20) NOT NULL,
    
    CONSTRAINT PK_REA PRIMARY KEY (FESTA_ID, SHOW),
    CONSTRAINT FK_REA_TEC FOREIGN KEY (TECNICO) REFERENCES TECNICOS(CPF) ON DELETE CASCADE,
    CONSTRAINT FK_REA_SHO FOREIGN KEY (SHOW) REFERENCES SHOW_FOGOS(TIPO_SHOW) ON DELETE CASCADE,
    CONSTRAINT FK_REA_DAT FOREIGN KEY (FESTA_ID) REFERENCES CASAMENTOS(FESTA_ID) ON DELETE CASCADE
);

CREATE TABLE FOTOGRAFOS (
    CPF VARCHAR2(14) NOT NULL,
    NOME VARCHAR2(20) NOT NULL,
    CONTATO VARCHAR2(13),
    VALOR FLOAT,
    
    CONSTRAINT PK_FOT PRIMARY KEY (CPF),
    CONSTRAINT CK_FOT_CON CHECK(REGEXP_LIKE(CONTATO, '[0-9]{2}\-[0-9]{5}\-[0-9]{4}')),
    CONSTRAINT CK_FOT_CPF CHECK(REGEXP_LIKE(CPF, '[0-9]{3}\.[0-9]{3}\.[0-9]{3}\-[0-9]{2}'))
);

CREATE TABLE ALBUM (
    FESTA_ID NUMBER NOT NULL,
    MODELO VARCHAR(20),
    LIM_FOTOS NUMBER(4),
    PRECO FLOAT,
    
    CONSTRAINT PK_ALB PRIMARY KEY (FESTA_ID),
    CONSTRAINT FK_ALB FOREIGN KEY (FESTA_ID) REFERENCES FESTAS(ID) ON DELETE CASCADE
);

CREATE TABLE FOTOS (
    FESTA_ID NUMBER NOT NULL,
    DATA_HORA_FOTO DATE NOT NULL,
    FOTOGRAFO VARCHAR2(14) NOT NULL,
    
    CONSTRAINT PK_FOTO PRIMARY KEY (FESTA_ID, DATA_HORA_FOTO, FOTOGRAFO),
    CONSTRAINT FK_FOTO_DAT FOREIGN KEY (FESTA_ID) REFERENCES ALBUM(FESTA_ID) ON DELETE CASCADE,
    CONSTRAINT FK_FOTO_FOT FOREIGN KEY (FOTOGRAFO) REFERENCES FOTOGRAFOS(CPF) ON DELETE CASCADE
);

CREATE TABLE MONITORES (
    CPF VARCHAR2(14) NOT NULL,
    NOME VARCHAR2(20) NOT NULL,
    CONTATO VARCHAR2(13),
    VALOR FLOAT,
    
    CONSTRAINT PK_MON PRIMARY KEY (CPF),
    CONSTRAINT CK_MON_CON CHECK(REGEXP_LIKE(CONTATO, '[0-9]{2}\-[0-9]{5}\-[0-9]{4}')),
    CONSTRAINT CK_MON_CPF CHECK(REGEXP_LIKE(CPF, '[0-9]{3}\.[0-9]{3}\.[0-9]{3}\-[0-9]{2}'))
);

CREATE TABLE ALUGUEL_BRINQUEDO (
    ID NUMBER NOT NULL,
    FESTA_ID NUMBER NOT NULL,
    NOM_BRINQUEDO VARCHAR2(20) NOT NULL,
    MOD_BRINQUEDO VARCHAR2(20) NOT NULL,
    
    CONSTRAINT PK_AB PRIMARY KEY (ID),
    CONSTRAINT UN_AB UNIQUE (FESTA_ID, NOM_BRINQUEDO, MOD_BRINQUEDO),
    CONSTRAINT FK_AB_DAT FOREIGN KEY (FESTA_ID) REFERENCES FESTAS(ID) ON DELETE CASCADE  
); 

CREATE TABLE MONITOR_ALUGUEL_BRINQUEDO (
    MONITOR VARCHAR2(14) NOT NULL,
    ALUGUEL_BRINQUEDO NUMBER NOT NULL,
    
    CONSTRAINT PK_MAB PRIMARY KEY (MONITOR, ALUGUEL_BRINQUEDO),
    
    CONSTRAINT FK_MAB_MON FOREIGN KEY (MONITOR) REFERENCES MONITORES(CPF) ON DELETE CASCADE,
    CONSTRAINT FK_MAB_AB FOREIGN KEY (ALUGUEL_BRINQUEDO) REFERENCES ALUGUEL_BRINQUEDO(ID) ON DELETE CASCADE
); 


CREATE TABLE BRINQUEDOS (
    NOME VARCHAR2(20) NOT NULL,
    MODELO VARCHAR2(20) NOT NULL,
    VALOR FLOAT,
    MAX_PESSOAS NUMBER(3),
    MAX_PESO FLOAT,
    
    CONSTRAINT PK_BRI PRIMARY KEY (NOME, MODELO)
);

CREATE TABLE ATRACOES_MUSICAIS (
    NOME_ARTISTICO VARCHAR(20) NOT NULL,
    CUSTO FLOAT,
    DURACAO NUMBER,
    ESTILO VARCHAR(20),
    TIPO VARCHAR(5) NOT NULL,
    
    CONSTRAINT PK_AM PRIMARY KEY (NOME_ARTISTICO)
);

CREATE TABLE INTEGRANTES (
    NOME VARCHAR2(20) NOT NULL,
    FUNCAO VARCHAR(20),
    CONTATO VARCHAR2(13) NOT NULL,
    BANDA VARCHAR(20),
    
    CONSTRAINT PK_INT PRIMARY KEY (NOME),
    CONSTRAINT FK_INT_BAN FOREIGN KEY (BANDA) REFERENCES ATRACOES_MUSICAIS(NOME_ARTISTICO) ON DELETE CASCADE,
    CONSTRAINT CK_INT_CON CHECK(REGEXP_LIKE(CONTATO, '[0-9]{2}\-[0-9]{5}\-[0-9]{4}'))
);

CREATE TABLE APRESENTACOES (
    ID NUMBER NOT NULL,
    FESTA_ID NUMBER NOT NULL,
    NOME_ARTISTICO VARCHAR2(20) NOT NULL,
    HORARIO DATE,
    
    CONSTRAINT PK_APR PRIMARY KEY (ID),
    CONSTRAINT UN_APR UNIQUE (FESTA_ID, NOME_ARTISTICO),
    CONSTRAINT FK_APR_NA FOREIGN KEY (NOME_ARTISTICO) REFERENCES ATRACOES_MUSICAIS(NOME_ARTISTICO) ON DELETE CASCADE,
    CONSTRAINT FK_APR_CAS FOREIGN KEY (FESTA_ID) REFERENCES CASAMENTOS(FESTA_ID) ON DELETE CASCADE
);

CREATE TABLE EQUIPAMENTOS (
    TIPO VARCHAR(20) NOT NULL,
    MODELO VARCHAR(20) NOT NULL,
    QUANTIDADE NUMBER(4),
    
    CONSTRAINT PK_EQUI PRIMARY KEY (TIPO, MODELO)
);
CREATE TABLE APRESENTACOES_EQUIPAMENTOS (
    APRESENTACAO NUMBER(5) NOT NULL,
    TIP_EQUIP VARCHAR2(20) NOT NULL,
    MOD_EQUIP VARCHAR2(20) NOT NULL,
    
    CONSTRAINT PK_AE PRIMARY KEY (APRESENTACAO, TIP_EQUIP, MOD_EQUIP),
    CONSTRAINT FK_AE_APR FOREIGN KEY (APRESENTACAO) REFERENCES APRESENTACOES (ID) ON DELETE CASCADE,
    CONSTRAINT FK_AE_EQUI FOREIGN KEY (TIP_EQUIP, MOD_EQUIP) REFERENCES EQUIPAMENTOS (TIPO,MODELO) ON DELETE CASCADE
);

create sequence seq_Aluguel_id  start with 0  increment by 1 minvalue 0;
create sequence seq_Festas_id  start with 0  minvalue 0;
create sequence seq_Ap_id  start with 0  minvalue 0;



CREATE OR REPLACE TRIGGER Aluguel_Brinquedo_id 
BEFORE INSERT ON ALUGUEL_BRINQUEDO
FOR EACH ROW

BEGIN
  SELECT seq_Aluguel_id.NEXTVAL
  INTO   :new.id
  FROM   dual;
END;


CREATE OR REPLACE TRIGGER Festas_id 
BEFORE INSERT ON FESTAS
FOR EACH ROW

BEGIN
  SELECT seq_Festas_id.NEXTVAL
  INTO   :new.id
  FROM   dual;
END;

CREATE OR REPLACE TRIGGER Apresentacao_id 
BEFORE INSERT ON APRESENTACOES
FOR EACH ROW

BEGIN
  SELECT seq_Ap_id.NEXTVAL
  INTO   :new.id
  FROM   dual;
END;